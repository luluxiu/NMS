<#include "../../../layout/header.html" >

<div class="pageheader">
  <h2><i class="fa fa-tasks"></i>分组配置</h2>
</div>

<!-- main content -->
<div class="contentpanel">
  <div class="row">
    <div class="col-md-12">
      <div class="panel">
        <div class="panel-heading">
          <h4 class="panel-title">分组 : <span class="groupName">N/A</span>
            <div class="pull-right">
              <button class="btn btn-default" type="button" name="refresh" title="Refresh">
                <i class="fa fa-refresh icon-refresh"></i>
              </button>
            </div>
          </h4>
        </div>
        <div class="panel-body">
          <!-- Nav tabs -->
          <ul class="nav nav-tabs nav-line">
            <li class="active"><a href="#wan" data-toggle="tab"><strong>WAN</strong></a></li>
            <li><a href="#lan" data-toggle="tab"><strong>LAN</strong></a></li>
            <li><a href="#wifi" data-toggle="tab"><strong>WiFi</strong></a></li>
            <li><a href="#ota" data-toggle="tab"><strong>OTA</strong></a></li>
          </ul>

          <div class="tab-content">

            <!-- wan tab-pane -->
            <div class="tab-pane active" id="wan">
              <div class="row">
                <div class="col-md-6">
                  <ul class="list-group groupConfigInfo">
                  </ul>
                </div>
              </div>
            </div>

            <!-- lan tab-pane -->
            <div class="tab-pane" id="lan">
              <div class="row">
                <div class="col-md-6">
                  <ul class="list-group groupConfigInfo">
                  </ul>
                </div>
              </div>
            </div>

            <!-- wifi tab-pane -->
            <div class="tab-pane" id="wifi">
              <div class="row">
                <div class="col-md-6">
                  <ul class="list-group groupConfigInfo">
                  </ul>
                </div>
              </div>
            </div>

            <!-- ota tab-pane -->
            <div class="tab-pane" id="ota">
              <div class="row">
                <div class="col-md-6">
                  <ul class="list-group groupConfigInfo">
                  </ul>
                </div>
              </div>
            </div>

          </div><!-- /.tab-content -->
        </div><!-- /.panel-body -->
      </div><!-- /.panel -->
    </div><!-- /.col-md-12 -->
  </div>
</div><!-- /.contentpanel -->

<script>
  var groupId = "${groupId ?if_exists}";
  var GROUP_CONFIG_URL = "${viewHelper.getPath()}/device/ap/group/" + groupId + "/configuration/show";

  $(function() {

    loadGroupInfo();
    $("button[name=refresh]").click(function() {
      clearHistoryInfo();
      loadGroupInfo();
    });

  })

  function loadGroupInfo() {
    $.ajax({
      cache: false,
      url: GROUP_CONFIG_URL,
      type: "get",
      success: function(result) {
        processConfigInfo(result);
      },
      error: function() {
        alert("获取信息失败");
      }
    });
  }

  function clearHistoryInfo() {
    $(".groupConfigInfo").empty();
  }

  function processConfigInfo(result) {

    $(".groupName").html(result.group.name);
    processConfigWanInfo(result.wan);
    processConfigLanInfo(result.lan);
    processConfigWiFiInfo(result.wifi);
    processConfigOtaInfo(result.ota);
  }

  function processConfigOtaInfo(ota) {
    var dom = "#ota .groupConfigInfo";

    if(!ota) {
      return;
    }

    switch(ota.mode) {
      case 0:
        appendDom(dom, "模式", "从不检查更新");
        break;

      case 1:
        appendDom(dom, "模式", "始终检查更新");
        break;

      case 2:
        appendDom(dom, "模式", "在时间窗口内检查更新");
        break;

      default:
        appendDom(dom, "模式", ota.mode);
        break;
    }

    appendDom(dom, "OTA 服务器地址", ota.server);
    appendDom(dom, "升级检测间隔", ota.pridDelay + " 分钟");

    if(ota.restoreFlag == 1) {
      appendDom(dom, "升级后是否还原出厂配置", "是");
    }
    else if(ota.restoreFlag == 0) {
      appendDom(dom, "升级后是否还原出厂配置", "否");
    }
    else {
      appendDom(dom, "升级后是否还原出厂配置", ota.restoreFlag);
    }

    if(ota.mode == 2) {
      appendDom(dom, "时间窗口起始时间", ota.windowStart);
      appendDom(dom, "时间窗口大小", ota.windowSize + " 小时");
    }
  }

  function processConfigWiFiInfo(wifi) {
    var dom = "#wifi .groupConfigInfo";

    if(!wifi) {
      return;
    }

    if(wifi.wifi == 1) {
      appendDom(dom, "WiFi", "开启");
    }
    else {
      appendDom(dom, "WiFi", "关闭");
    }

    appendDom(dom, "SSID", wifi.ssid);
    appendDom(dom, "信道", wifi.channel);
    appendDom(dom, "最大连接数", wifi.maxStation);
    appendDom(dom, "加密方式", wifi.encryption);

    switch(wifi.encryption) {
      case "none":
        break;

      case "open":
        appendDom(dom, "密码", wifi.key);
        break;

      case "psk":
        /* pass through */

      case "psk2":
        /* pass through */

      case "psk-mixed":
        appendDom(dom, "算法", wifi.cipher);
        appendDom(dom, "密码", wifi.key);
        break;
    }
  }


  function processConfigLanInfo(lan) {
    var dom = "#lan .groupConfigInfo";

    if(!lan) {
      return;
    }

    appendDom(dom, "IP", lan.lanAddress);
    appendDom(dom, "子网掩码", lan.lanNetmask);

    if(lan.dhcp == 0) {
      appendDom(dom, "DHCP", "关闭");
      return;
    }

    appendDom(dom, "DHCP", "开启");

    appendDom(dom, "开始", lan.start);
    appendDom(dom, "客户数", lan.limit);
    appendDom(dom, "租用时间", lan.leaseTime);
  }

  function processConfigWanInfo(wan) {
    var dom = "#wan .groupConfigInfo";

    if(!wan || !wan.protocol) {
      return;
    }

    appendDom(dom, "模式", wan.protocol);
    switch(wan.protocol) {
      case "dhcp":
        break;

      case "static":
        appendDom(dom, "IP", wan.address);
        appendDom(dom, "子网掩码", wan.netmask);
        appendDom(dom, "网关", wan.gateway);
        break;

      case "pppoe":
        appendDom(dom, "用户名", wan.username);
        appendDom(dom, "密码", wan.password);
        break;

      case "3g":
        appendDom(dom, "调制解调器节点", wan.modemDevice);
        appendDom(dom, "服务类型", wan.serviceType);
        appendDom(dom, "APN", wan.APN);
        appendDom(dom, "Dial Number", wan.dialNumber);
        break;

      default:
        break;
    }
  }

  function appendDom(selector, key, value) {

    if(!selector || !key || !value) {
      return;
    }

    $(selector).append(
        '<li class="list-group-item">'
        + key
        + '<span>'
        + value
        + '</span></li>');
  }

</script>


<#include "../../../layout/footer.html" >